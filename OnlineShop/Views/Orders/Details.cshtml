@model Order

@{
    ViewData["Title"] = "Details";
}

<h1>Szczegóły zamówienia</h1>

<div>
    <h4>Zamówienie nr @($"{Model.Id}")</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.OrderDate)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.OrderDate)
        </dd>
        <dt class="col-sm-2">Użytkownik</dt>
        <dd class="col-sm-10">
            @(Model.User != null ? $"{Model.User.FirstName} {Model.User.LastName}" : Model.UserId)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.Status)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.Status)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.TotalPrice)
        </dt>
        <dd class="col-sm-10">
            @String.Format("{0:C}", Model.TotalPrice)
        </dd>
    </dl>
</div>

<h4>Pozycje zamówienia</h4>

@if (Model.OrderItems == null || !Model.OrderItems.Any())
{
    <p>Brak pozycji w zamówieniu.</p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Zdjęcie</th>
                <th>Produkt</th>
                <th>Ilość</th>
                <th>Cena jedn.</th>
                <th>Razem</th>
                <th>Uwagi</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var it in Model.OrderItems)
            {
                <tr>
                    <td style="width:90px;">
                        <img src="@(it.Product?.ImageUrl ?? it.ProductImageUrl ?? "/images/placeholder.png")"
                             alt="@(it.Product?.Name ?? (string.IsNullOrEmpty(it.ProductName) ? $"Produkt #{it.ProductId}" : it.ProductName))"
                             class="img-fluid rounded"
                             style="width:80px;height:80px;object-fit:cover;" />
                    </td>
                    <td>
                        @if (it.Product != null)
                        {
                            <a asp-controller="Products" asp-action="Details" asp-route-id="@it.ProductId">@it.Product.Name</a>
                        }
                        else
                        {
                            @(string.IsNullOrEmpty(it.ProductName) ? $"Produkt #{it.ProductId}" : it.ProductName)
                        }
                    </td>
                    <td>@it.Quantity</td>
                    <td>@String.Format("{0:C}", it.UnitPrice)</td>
                    <td>@String.Format("{0:C}", it.UnitPrice * it.Quantity)</td>
                    <td>@it.Notes</td>
                </tr>
            }
        </tbody>
    </table>

    <div class="text-end">
        <h5>Do zapłaty: @String.Format("{0:C}", Model.OrderItems.Sum(i => i.UnitPrice * i.Quantity))</h5>
    </div>
}

<div class="mt-3">
    <a asp-action="Index" class="btn btn-secondary">Powrót do listy</a>
    @if (User.IsInRole("Admin"))
    {
        <a asp-action="Edit" asp-route-id="@Model?.Id" class="btn btn-primary ms-2">Edytuj</a>
    }
</div>
